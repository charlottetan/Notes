
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.1, mkdocs-material-7.1.9">
    
    
      
        <title>Distributed Message Queue - RKK1995's notes</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.ca7ac06f.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.f1a3b89f.min.css">
        
          
          
          <meta name="theme-color" content="#4051b5">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7C&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:""}</style>
      
    
    
    
      <link rel="stylesheet" href="../../stylesheets/dt.css">
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="indigo" data-md-color-accent="red">
  
    
    <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#distributed-message-queue" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../index.html" title="RKK1995&#39;s notes" class="md-header__button md-logo" aria-label="RKK1995's notes" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            RKK1995's notes
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Distributed Message Queue
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
      <div class="md-header__source">
        
<a href="https://github.com/rkk1995/Notes/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../../index.html" class="md-tabs__link">
      About the Site
    </a>
  </li>

      
        
  
  


  
  
  
    

  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../Notes/papers/Storage/aurora.html" class="md-tabs__link">
        Notes
      </a>
    </li>
  

  

  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../Template.html" class="md-tabs__link md-tabs__link--active">
        System Design
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../index.html" title="RKK1995&#39;s notes" class="md-nav__button md-logo" aria-label="RKK1995's notes" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    RKK1995's notes
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/rkk1995/Notes/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../index.html" class="md-nav__link">
        About the Site
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      <label class="md-nav__link" for="__nav_2">
        Notes
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Notes" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Notes
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_1" type="checkbox" id="__nav_2_1" >
      
      <label class="md-nav__link" for="__nav_2_1">
        Papers
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Papers" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_1">
          <span class="md-nav__icon md-icon"></span>
          Papers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_1_1" type="checkbox" id="__nav_2_1_1" >
      
      <label class="md-nav__link" for="__nav_2_1_1">
        Storage
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Storage" data-md-level="3">
        <label class="md-nav__title" for="__nav_2_1_1">
          <span class="md-nav__icon md-icon"></span>
          Storage
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Notes/papers/Storage/aurora.html" class="md-nav__link">
        Aurora
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Notes/papers/Storage/craq.html" class="md-nav__link">
        CRAQ
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Notes/papers/Storage/dynamo.html" class="md-nav__link">
        Dynamo
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Notes/papers/Storage/farm.html" class="md-nav__link">
        FaRM
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Notes/papers/Storage/frangipani.html" class="md-nav__link">
        Frangipani
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Notes/papers/Storage/gfs.html" class="md-nav__link">
        GFS
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Notes/papers/Storage/memcache.html" class="md-nav__link">
        Memcache
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Notes/papers/Storage/spanner.html" class="md-nav__link">
        Spanner
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Notes/papers/Storage/tao.html" class="md-nav__link">
        TAO
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_1_2" type="checkbox" id="__nav_2_1_2" >
      
      <label class="md-nav__link" for="__nav_2_1_2">
        Compute
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Compute" data-md-level="3">
        <label class="md-nav__title" for="__nav_2_1_2">
          <span class="md-nav__icon md-icon"></span>
          Compute
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Notes/papers/Compute/distributedTransactions.html" class="md-nav__link">
        Distributed Transactions
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Notes/papers/Compute/mapreduce.html" class="md-nav__link">
        MapReduce
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_1_3" type="checkbox" id="__nav_2_1_3" >
      
      <label class="md-nav__link" for="__nav_2_1_3">
        Cluster Management
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Cluster Management" data-md-level="3">
        <label class="md-nav__title" for="__nav_2_1_3">
          <span class="md-nav__icon md-icon"></span>
          Cluster Management
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Notes/papers/Cluster%20Management/raft.html" class="md-nav__link">
        Raft
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Notes/papers/Cluster%20Management/zookeeper.html" class="md-nav__link">
        ZooKeeper
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_2" type="checkbox" id="__nav_2_2" >
      
      <label class="md-nav__link" for="__nav_2_2">
        Books
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Books" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          Books
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_2_1" type="checkbox" id="__nav_2_2_1" >
      
      <label class="md-nav__link" for="__nav_2_2_1">
        DDIA
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="DDIA" data-md-level="3">
        <label class="md-nav__title" for="__nav_2_2_1">
          <span class="md-nav__icon md-icon"></span>
          DDIA
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Notes/books/DDIA/chapter1.html" class="md-nav__link">
        1. Reliable, scalable, and maintainable applications
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Notes/books/DDIA/chapter2.html" class="md-nav__link">
        2. Data Models and Query Languages
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Notes/books/DDIA/chapter3.html" class="md-nav__link">
        3. Storage and retrieval
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Notes/books/DDIA/chapter4.html" class="md-nav__link">
        4. Encoding and evolution
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Notes/books/DDIA/chapter5.html" class="md-nav__link">
        5. Replication
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Notes/books/DDIA/chapter6.html" class="md-nav__link">
        6. Partitioning
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Notes/books/DDIA/chapter7.html" class="md-nav__link">
        7. Transactions
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Notes/books/DDIA/chapter8.html" class="md-nav__link">
        8. The Trouble With Distributed Systems
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_3" type="checkbox" id="__nav_2_3" >
      
      <label class="md-nav__link" for="__nav_2_3">
        Todo
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Todo" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_3">
          <span class="md-nav__icon md-icon"></span>
          Todo
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../Notes/todo/articles.html" class="md-nav__link">
        TODO
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      <label class="md-nav__link" for="__nav_3">
        System Design
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="System Design" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          System Design
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Template.html" class="md-nav__link">
        Template
      </a>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2" type="checkbox" id="__nav_3_2" >
      
      <label class="md-nav__link" for="__nav_3_2">
        Concepts
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Concepts" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          Concepts
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Concepts/CDN.html" class="md-nav__link">
        CDN
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Concepts/Cache.html" class="md-nav__link">
        Cache
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Concepts/Communication.html" class="md-nav__link">
        Communication
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Concepts/DNS.html" class="md-nav__link">
        DNS
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Concepts/Load%20Balancer.html" class="md-nav__link">
        Load Balancer
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Concepts/Reverse%20Proxy.html" class="md-nav__link">
        Reverse Proxy
      </a>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2_7" type="checkbox" id="__nav_3_2_7" >
      
      <label class="md-nav__link" for="__nav_3_2_7">
        Databases
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Databases" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_2_7">
          <span class="md-nav__icon md-icon"></span>
          Databases
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Concepts/Databases/index.html" class="md-nav__link">
        Databases
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Concepts/Databases/SQL%20or%20NoSQL.html" class="md-nav__link">
        SQL or NoSQL
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Concepts/Databases/test.html" class="md-nav__link">
        test
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2_8" type="checkbox" id="__nav_3_2_8" >
      
      <label class="md-nav__link" for="__nav_3_2_8">
        Misc
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Misc" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_2_8">
          <span class="md-nav__icon md-icon"></span>
          Misc
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Concepts/Misc/backOfTheEnvelope.html" class="md-nav__link">
        Back of Envelope Calculations
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Concepts/Misc/encodingAndDecoding.html" class="md-nav__link">
        Encoding And Decoding
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3" type="checkbox" id="__nav_3_3" checked>
      
      <label class="md-nav__link" for="__nav_3_3">
        System Design Interview YT Channel
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="System Design Interview YT Channel" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_3">
          <span class="md-nav__icon md-icon"></span>
          System Design Interview YT Channel
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="distributedCache.html" class="md-nav__link">
        Distributed Cache
      </a>
    </li>
  

          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Distributed Message Queue
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="distributedMessageQueue.html" class="md-nav__link md-nav__link--active">
        Distributed Message Queue
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#synchronous-vs-asynchronous" class="md-nav__link">
    Synchronous vs Asynchronous
  </a>
  
    <nav class="md-nav" aria-label="Synchronous vs Asynchronous">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synchronous-communication" class="md-nav__link">
    Synchronous Communication
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asynchronous-communication" class="md-nav__link">
    Asynchronous Communication
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#functional-requirements" class="md-nav__link">
    Functional Requirements
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#non-functional-requirements" class="md-nav__link">
    Non-Functional Requirements
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#high-level-architecture" class="md-nav__link">
    High-level Architecture
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vip-and-load-balancer" class="md-nav__link">
    VIP and Load Balancer
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#frontend-service" class="md-nav__link">
    FrontEnd Service
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metadata-service" class="md-nav__link">
    Metadata Service
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#backend-service" class="md-nav__link">
    Backend Service
  </a>
  
    <nav class="md-nav" aria-label="Backend Service">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#option-a-leader-follower-relationship" class="md-nav__link">
    Option A : Leader - Follower Relationship
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#option-b-small-cluster-of-independent-hosts" class="md-nav__link">
    Option B : Small cluster of independent hosts
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#in-cluster-manager-vs-out-cluster-manager" class="md-nav__link">
    In-cluster Manager vs Out-cluster Manager
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-else-is-important" class="md-nav__link">
    What else is important?
  </a>
  
    <nav class="md-nav" aria-label="What else is important?">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#queue-creation-and-deletion" class="md-nav__link">
    Queue creation and deletion
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#message-deletion" class="md-nav__link">
    Message deletion
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#message-replication" class="md-nav__link">
    Message replication
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#message-delivery-semantics" class="md-nav__link">
    Message delivery semantics
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#push-vs-pull" class="md-nav__link">
    Push vs Pull
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fifo" class="md-nav__link">
    FIFO
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#security" class="md-nav__link">
    Security
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#monitoring" class="md-nav__link">
    Monitoring
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#final-look" class="md-nav__link">
    Final Look
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="notificationService.html" class="md-nav__link">
        Notification Service
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="rateLimiting.html" class="md-nav__link">
        Rate Limiting (local and distributed)
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="stepByStepGuide.html" class="md-nav__link">
        Step By Step Guide
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="topKHeavyHitters.html" class="md-nav__link">
        Top K Heavy Hitters
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_4" type="checkbox" id="__nav_3_4" >
      
      <label class="md-nav__link" for="__nav_3_4">
        Examples
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Examples" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_4">
          <span class="md-nav__icon md-icon"></span>
          Examples
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Examples/trendingTopics.html" class="md-nav__link">
        Trending Topics
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_5" type="checkbox" id="__nav_3_5" >
      
      <label class="md-nav__link" for="__nav_3_5">
        Real World Examples
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Real World Examples" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_5">
          <span class="md-nav__icon md-icon"></span>
          Real World Examples
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_5_1" type="checkbox" id="__nav_3_5_1" >
      
      <label class="md-nav__link" for="__nav_3_5_1">
        Facebook
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Facebook" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_5_1">
          <span class="md-nav__icon md-icon"></span>
          Facebook
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Real%20World%20Examples/Facebook/FacebookIris.html" class="md-nav__link">
        Iris - Building Mobile-First Infrastructure for Messenger
      </a>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_5_1_2" type="checkbox" id="__nav_3_5_1_2" >
      
      <label class="md-nav__link" for="__nav_3_5_1_2">
        TAO
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="TAO" data-md-level="4">
        <label class="md-nav__title" for="__nav_3_5_1_2">
          <span class="md-nav__icon md-icon"></span>
          TAO
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Real%20World%20Examples/Facebook/TAO/Wormhole.html" class="md-nav__link">
        Large-Scale Low-Latency Storage for the Social Network
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_5_2" type="checkbox" id="__nav_3_5_2" >
      
      <label class="md-nav__link" for="__nav_3_5_2">
        LinkedIn
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="LinkedIn" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_5_2">
          <span class="md-nav__icon md-icon"></span>
          LinkedIn
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Real%20World%20Examples/LinkedIn/LinkedInRealTimeVideo.html" class="md-nav__link">
        LinkedIn Real-Time Interactions on Live Video
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_5_3" type="checkbox" id="__nav_3_5_3" >
      
      <label class="md-nav__link" for="__nav_3_5_3">
        Netflix
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Netflix" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_5_3">
          <span class="md-nav__icon md-icon"></span>
          Netflix
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Real%20World%20Examples/Netflix/ScalingPush.html" class="md-nav__link">
        Scaling Push Messages
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#synchronous-vs-asynchronous" class="md-nav__link">
    Synchronous vs Asynchronous
  </a>
  
    <nav class="md-nav" aria-label="Synchronous vs Asynchronous">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synchronous-communication" class="md-nav__link">
    Synchronous Communication
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asynchronous-communication" class="md-nav__link">
    Asynchronous Communication
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#functional-requirements" class="md-nav__link">
    Functional Requirements
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#non-functional-requirements" class="md-nav__link">
    Non-Functional Requirements
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#high-level-architecture" class="md-nav__link">
    High-level Architecture
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vip-and-load-balancer" class="md-nav__link">
    VIP and Load Balancer
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#frontend-service" class="md-nav__link">
    FrontEnd Service
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metadata-service" class="md-nav__link">
    Metadata Service
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#backend-service" class="md-nav__link">
    Backend Service
  </a>
  
    <nav class="md-nav" aria-label="Backend Service">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#option-a-leader-follower-relationship" class="md-nav__link">
    Option A : Leader - Follower Relationship
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#option-b-small-cluster-of-independent-hosts" class="md-nav__link">
    Option B : Small cluster of independent hosts
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#in-cluster-manager-vs-out-cluster-manager" class="md-nav__link">
    In-cluster Manager vs Out-cluster Manager
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-else-is-important" class="md-nav__link">
    What else is important?
  </a>
  
    <nav class="md-nav" aria-label="What else is important?">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#queue-creation-and-deletion" class="md-nav__link">
    Queue creation and deletion
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#message-deletion" class="md-nav__link">
    Message deletion
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#message-replication" class="md-nav__link">
    Message replication
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#message-delivery-semantics" class="md-nav__link">
    Message delivery semantics
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#push-vs-pull" class="md-nav__link">
    Push vs Pull
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fifo" class="md-nav__link">
    FIFO
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#security" class="md-nav__link">
    Security
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#monitoring" class="md-nav__link">
    Monitoring
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#final-look" class="md-nav__link">
    Final Look
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/rkk1995/Notes/edit/master/docs/System Design/System Design Interview YT Channel/distributedMessageQueue.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="distributed-message-queue">Distributed Message Queue</h1>
<iframe width="560" height="315" src="https://www.youtube.com/embed/iJLL-KPqBpM" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

<hr />
<h2 id="synchronous-vs-asynchronous">Synchronous vs Asynchronous</h2>
<p><img alt="" src="image/distributedMessageQueue/1634617893191.png" /></p>
<h3 id="synchronous-communication">Synchronous Communication</h3>
<ul>
<li>When producer makes a call to a consumer, waits for a response.</li>
<li>Easier and faster to implement.</li>
<li>Harder to deal with consumer service failures. Need to think;<ul>
<li>When and how to properly retry failed requests?</li>
<li>How not to overwhelm consumer service with too many requests?</li>
<li>How to deal with a slow consumer service host?</li>
</ul>
</li>
</ul>
<h3 id="asynchronous-communication">Asynchronous Communication</h3>
<ul>
<li>Queue : Producer sends data to that component and exactly one consumer gets this data to a short time after.</li>
<li>It is distributed, because data is stored across several machines.</li>
<li>Do not confuse queue with topic. In case of a topic, message goes to all subscribers. In case of a queue, message is received by only one consumer.</li>
</ul>
<h2 id="functional-requirements">Functional Requirements</h2>
<ul>
<li>sendMessage(messageBody)</li>
<li>receiveMessage()</li>
</ul>
<h2 id="non-functional-requirements">Non-Functional Requirements</h2>
<ul>
<li>Scalable (handles load increases, more queues and messages)</li>
<li>Highly Available (survives hardware/network failures)</li>
<li>Highly Performant (single digit latency for main operations)</li>
<li>Durable (once submitted, data is persisted)</li>
</ul>
<h2 id="high-level-architecture">High-level Architecture</h2>
<p><img alt="" src="image/distributedMessageQueue/1634618049070.png" /></p>
<ul>
<li>VIP : Virtual IP : Refers to the symbolic hostname (myWebService.domain.com) that resolves to a load balancer system.</li>
<li>Load Balancer : A device that routes client requests across a number of servers.</li>
<li>FrontEnd Web Service : A component responsible for initial request processing, like validation, authentication.</li>
<li>Queue Metadata : Queue's name, creation date / time, owner and any other configuration settings will be stored in a DB.</li>
<li>Metadata service : As a best practice, this metadata DB should be hidden behind some interface, a dedicated web service responsible for handling calls to that DB.</li>
<li>BackEnd Web Service : Responsible for message persistence and processing.</li>
</ul>
<h2 id="vip-and-load-balancer">VIP and Load Balancer</h2>
<p><img alt="" src="image/distributedMessageQueue/1634618086767.png" /></p>
<ul>
<li>Load balancing is a big topic and unless interviewer asks to deep dive on it, try to stay on topic to main question of the interview. Internals may not matter, however to ensure that non-functional requirements to the system are met we need to explain how Load Balancer help us achieve high throughput and availability.</li>
<li>When domain name is hit, request is transferred to one of the VIPs registered in DNS for our domain name.</li>
<li>VIP is resolved to a load balancer device, which has a knowledge of FrontEnd hosts.</li>
</ul>
<p>Several Points:</p>
<ul>
<li>First, load balancer seems like a single point of failure. What happens if load balancer device goes down?</li>
<li>Second, load balancers have limits with regards to number of requests they can process and number of bytes they can transfer. What happens when our distributed message queue service becomes so popular that load balancer limits are reached?</li>
</ul>
<ul>
<li>To address high availability concerns, load balancers utilize a concept of primary and secondary nodes. The primary node accepts connections and serves requests while the secondary node monitors the primary. If, the primary node is unable to accept connections, the secondary node takes over.</li>
<li>As for scalability concerns, a concept of multiple VIPs (sometimes referred as VIP partitioning) can be utilized. In DNS we assign multiple A-records to the same DNS name for the service. As a result, requests are partitioned across several load balancers.</li>
<li>The "A" stands for "address" and this is the most fundamental type of <a href="https://www.cloudflare.com/learning/dns/what-is-dns/">DNS</a> record: it indicates the <a href="https://www.cloudflare.com/learning/dns/glossary/what-is-my-ip-address/">IP address</a> of a given <a href="https://www.cloudflare.com/learning/dns/glossary/what-is-a-domain-name/">domain</a>.</li>
<li>And by spreading load balancers across several data centers, we improve both availability and performance.</li>
</ul>
<h2 id="frontend-service">FrontEnd Service</h2>
<ul>
<li>FrontEnd is a lightweight web service, consisting of stateless machines located across several data centers.</li>
<li>FrontEnd service is responsible for:<ul>
<li><strong>Request validation</strong> : Helps to ensure that all the required parameters are present in the request and values of these parameters honor constraints. For example, in our case we want to make sure queue name comes with every send message request. And message size does not exceed a specified threshold.</li>
<li><strong>Authentication and authorization</strong> : During authentication check we verify that message sender is a registered customer of our distributed queue service. And during authorization check we verify that sender is allowed to publish messages to the queue it claims.</li>
<li><strong>TLS termination</strong> : TLS is a protocol that aims to provide privacy and data integrity. TLS termination refers to the process of decrypting request and passing on an unencrypted request to the backend service. And we want to do TLS termination on FrontEnd hosts because TLS on the load balancer is expensive. Termination is usually handled by not a FrontEnd service itself, but a separate HTTP proxy that runs as a process on the same host.</li>
<li><strong>Server-side data encryption</strong> : Because we want to store messages securely on backend hosts, messages are encrypted as soon as FrontEnd receives them. Messages are stored in encrypted form and FrontEnd decrypts them only when they are sent back to a consumer.</li>
<li><strong>Caching</strong> : Cache stores copies of source data. In FrontEnd cache we will store metadata information about the most actively used queues. As well as user identity information to save on calls to authentication and authorization services.</li>
<li><strong>Rate limiting (Throttling)</strong> : Rate limiting or throttling is the process of limiting the number of requests you can submit to a given operation in a given amount of time. Throttling protects the web service from being overwhelmed with requests. Leaky bucket algorithm is one of the most famous.</li>
<li><strong>Request dispatching</strong> : FrontEnd service makes remote calls to at least two other web services: Metadata service and backend service. FrontEnd service creates HTTP clients for both services and makes sure that calls to these services are properly isolated. It means that when one service let's say Metadata service experiences a slowdown, requests to backend service are not impacted. There are common patterns like bulkhead and circuit breaker that helps to implement resources isolation and make service more resilient in cases when remote calls start to fail.</li>
<li><strong>Request deduplication</strong> : It may occur when a response from a successful send message request failed to reach a client. Lesser an issue for 'at least once' delivery semantics, a bigger issue for 'exactly once' and 'at most once' delivery semantics, when we need to guarantee that message was never processed more than one time. Caching is usually used to store previously seen request ids to avoid deduplication.</li>
<li><strong>Usage data collection</strong> : When we gather real-time information that can be used for audit.</li>
</ul>
</li>
<li>And even though FrontEnd service has many responsibilities, the rule of thumb is to keep it as simple as possible.</li>
</ul>
<h2 id="metadata-service">Metadata Service</h2>
<p><img alt="" src="image/distributedMessageQueue/1634618278329.png" /></p>
<ul>
<li>Metadata service stores information about queues.</li>
<li>Every time queue is created, we store information about it in the database. Conceptually, Metadata service is a caching layer between the FrontEnd and a persistent storage.</li>
<li>It handles many reads and a relatively small number of writes. As we read every time message arrives and write only when new queue is created.</li>
<li>Even though strongly consistent storage is preferred to avoid potential concurrent updates, it is not strictly required.</li>
<li>Different approaches of organizing cache clusters:<ul>
<li>The first option is when cache is relatively small and we can store the whole data set on every cluster node. FrontEnd host calls a randomly chosen Metadata service host, because all the cache cluster nodes contain the same information.</li>
<li>Second approach is to partition data into small chunks, called shards. Because data set is too big and cannot be placed into a memory of a single host. So, we store each such chunk of data on a separate node in a cluster. FrontEnd then knows which shard stores the data and calls the shard directly.</li>
<li>And the third option is similar to the second one. We also partition data into shards, but FrontEnd does not know on what shard data is stored. So, FrontEnd calls a random Metadata service host and host itself knows where to forward the request to.</li>
</ul>
</li>
<li>In option one, we can introduce a load balancer between FrontEnd and Metadata service. As all Metadata service hosts are equal and FrontEnd does not care which Metadata host handles the request.</li>
<li>In option two and three, Metadata hosts represent a consistent hashing ring.</li>
</ul>
<h2 id="backend-service">Backend Service</h2>
<p><img alt="" src="image/distributedMessageQueue/1634618304766.png" /></p>
<ul>
<li>To understand how backend service architecture may look like, start asking the right questions.</li>
</ul>
<ul>
<li>Where and how messages are stored?<ul>
<li>Is database an option? Yes but not the best one. We're building a distributed message queue, a system that needs to handle high throughput, which means all the throughput will be uploaded to the database. In other words, a problem of building a distributed message queue becomes a problem of developing a database that can handle high throughput. These kinds of databases exist out there. It's reasonable for a junior engineer to recommend to use a database.</li>
<li>As we may need to store messages for days/weeks, we need more durable storage like local disk. Newly arrived messages may live in memory for a short period of time or until memory on the backend host is fully utilized.</li>
<li>File system also works.</li>
</ul>
</li>
<li>How do we replicate data?<ul>
<li>We will send copies of messages to some other hosts, so that data can survive host hardware or software failures.</li>
</ul>
</li>
<li>How FrontEnd hosts select backend hosts for both storing messages and retrieving them.<ul>
<li>We can leverage Metadata service.</li>
</ul>
</li>
<li>Message comes to the FrontEnd, FrontEnd consults Metadata service what backend host to send data to. Message is sent to a selected backend host and data is replicated.</li>
<li>When receive message call comes, FrontEnd talks to Metadata service to identify a backend host that stores the data.</li>
<li>We will consider two options of how backend hosts relate to each other.</li>
</ul>
<h3 id="option-a-leader-follower-relationship">Option A : Leader - Follower Relationship</h3>
<p><img alt="" src="image/distributedMessageQueue/1634619149759.png" /></p>
<ul>
<li>Each backend instance is considered a leader for a particular set of queues.</li>
<li>And by leader we mean that all requests for a particular queue (like send message and receive message requests) go to this leader instance.</li>
<li>Send message request comes to a FrontEnd instance.</li>
<li>Message comes to a queue with ID equal to q1.</li>
<li>FrontEnd service calls Metadata service to identify a leader backend instance for this queue.</li>
<li>In this particular example, instance B is a leader for q1.</li>
<li>Message is sent to the leader and the leader is fully responsible for data replication.</li>
<li>When receive message request comes to a FrontEnd instance, it also makes a request to the Metadata service to identify the leader for the queue.</li>
<li>Message is then retrieved from the leader instance and leader is responsible for cleaning up the original message and all the replicas.</li>
<li>We need a component that will help us with leader election and management.</li>
<li>Let's call it In-cluster manager.</li>
<li>And as already mentioned, in-cluster manager is responsible for maintaining a mapping between queues, leaders and followers.</li>
<li>In-cluster manager is a very sophisticated component.</li>
<li>It has to be reliable, scalable and performant.</li>
</ul>
<h3 id="option-b-small-cluster-of-independent-hosts">Option B : Small cluster of independent hosts</h3>
<p><img alt="" src="image/distributedMessageQueue/1634619160455.png" /></p>
<ul>
<li>We have a set of small clusters, each cluster consists of 3-4 machines distributed across several data centers.</li>
<li>When send message request comes, similar to the previous design option, we also need to call Metadata service to identify which cluster is responsible for storing messages for the q1 queue.</li>
<li>After that we just make a call to a randomly selected instance in the cluster.</li>
<li>And instance is responsible for data replication across all nodes in the cluster.</li>
<li>When receive message request comes and we identified which cluster stores messages for the q1 queue, we once again call a randomly selected host and retrieve the message.</li>
<li>Selected host is responsible for the message cleanup.</li>
<li>As you may see, we no longer need a component for leader election, but we still need something that will help us to manage queue to cluster assignments.</li>
<li>Let's call this component an Out-cluster manager.</li>
<li>And this component will be responsible for maintaining a mapping between queues and clusters.</li>
</ul>
<h3 id="in-cluster-manager-vs-out-cluster-manager">In-cluster Manager vs Out-cluster Manager</h3>
<ul>
<li>In-cluster manager manages queue assignment within the cluster, out-cluster manager manages queue assignment across clusters.</li>
<li>In-cluster manager needs to know about each and every instance in the cluster. Out-cluster manager may not know about each particular instance, but it needs to know about each cluster.</li>
<li>In-cluster manager listens to heartbeats from instances. Out-cluster manager monitors health of each independent cluster.</li>
<li>In-cluster manager deals with host failures and needs to adjust to the fact that instances may die and new instances may be added to the cluster, out-cluster manager is responsible for tracking each cluster utilization and deal with overheated clusters. Meaning that new queues may no longer be assigned to clusters that reached their capacity limits.</li>
<li>In-cluster manager splits queue into parts (partitions) and each partition gets a leader server. Out-cluster manager may split queue across several clusters. So that messages for the same queue are equally distributed between several clusters.</li>
</ul>
<h2 id="what-else-is-important">What else is important?</h2>
<h3 id="queue-creation-and-deletion">Queue creation and deletion</h3>
<ul>
<li>Queue can be auto-created, for example when the first message for the queue hits FrontEnd service, or we can define API for queue creation.</li>
<li>API is a better option, as we will have more control over queue configuration parameters.</li>
<li>Delete queue operation is a bit controversial, as it may cause a lot of harm and must be executed with caution.</li>
<li>For this reason, you may find examples of well-known distributed queues that do not expose deleteQueue API via public REST endpoint.</li>
<li>Instead, this operation may be exposed through a command line utility, so that only experienced admin users may call it.</li>
</ul>
<h3 id="message-deletion">Message deletion</h3>
<ul>
<li>There are several options at our disposal.<ul>
<li>One option is not to delete a message right after it was consumed. In this case consumers have to be responsible for what they already consumed. And it is not as easy as it sounds. As we need to maintain some kind of an order for messages in the queue and keep track of the offset, which is the position of a message within a queue. Messages can then be deleted several days later, by a job. This idea is used by Apache Kafka.</li>
<li>The second option, is to do something similar to what Amazon SQS is doing. Messages are also not deleted immediately, but marked as invisible (known as visibility timeout), so that other consumers may not get already retrieved message. Consumer that retrieved the message, needs to then call delete message API to delete the message from a backend host. And if the message was not explicitly deleted by a consumer, message becomes visible and may be delivered and processed twice. When a consumer consumes a message, a lease is granted for duration of visibility timeout. When consumer calls delete API, consumer must still hold the lease or else delete API will fail.</li>
</ul>
</li>
</ul>
<h3 id="message-replication">Message replication</h3>
<ul>
<li>Messages need to be replicated to achieve high durability. Otherwise, if we only have one copy of data, it may be lost due to unexpected hardware failure.</li>
<li>Messages can be replicated synchronously or asynchronously.<ul>
<li>Synchronously means that when backend host receives new message, it waits until data is replicated to other hosts. And only if replication is fully completed, successful response is returned to a producer.</li>
<li>Asynchronous replication means that response is returned back to a producer as soon as message is stored on a single backend host. In this case we will need to store data in log file incase of system crash.
Message is later replicated to other hosts.</li>
</ul>
</li>
<li>Both options have pros and cons.<ul>
<li>Synchronous replication provides higher durability, but with a cost of higher latency for send message operation.</li>
<li>Asynchronous replication is more performant, but does not guarantee that message will survive backend host failure.</li>
</ul>
</li>
</ul>
<h3 id="message-delivery-semantics">Message delivery semantics</h3>
<ul>
<li>There are three main message delivery guarantees.<ul>
<li>At most once, when messages may be lost but are never redelivered.</li>
<li>At least once, when messages are never lost but may be redelivered.</li>
<li>And exactly once, when each message is delivered once and only once.</li>
</ul>
</li>
<li>Will anyone ever want other than exactly once delivery? The simple answer is that it is hard to achieve exactly once delivery in practice.</li>
<li>In a distributed message queue system there are many potential points of failure. Producer may fail to deliver or deliver multiple times, data replication may fail, consumers may fail to retrieve or process the message.</li>
<li>All this adds complexity and leads to the fact that most distributed queue solutions today support at-least-once delivery, as it provides a good balance between durability, availability and performance.</li>
</ul>
<h3 id="push-vs-pull">Push vs Pull</h3>
<ul>
<li>With a pull model, consumer constantly sends retrieve message requests and when new message is available in the queue, it is sent back to a consumer.</li>
<li>With a push model, consumer is not constantly bombarding FrontEnd service with receive calls. Instead, consumer is notified as soon as new message arrives to the queue.</li>
<li>And as always, there are pros and cons. From a distributed message queue perspective pull is easier to implement than a push. But from a consumer perspective, we need to do more work if we pull.</li>
</ul>
<h3 id="fifo">FIFO</h3>
<ul>
<li>FIFO stands for first-in, first-out, meaning that the oldest message in a queue is always processed first.</li>
<li>But in distributed systems, it is hard to maintain a strict order. Message A may be produced prior to message B, but it is hard to guarantee that message A will be stored and consumed prior to message B.</li>
<li>For these reasons many distributed queue solutions out there either does not guarantee a strict order. Or have limitations around throughput, as queue cannot be fast while it's doing many additional validations and coordination to guarantee a strict order.</li>
</ul>
<h3 id="security">Security</h3>
<ul>
<li>We need to make sure that messages are securely transferred to and from a queue.</li>
<li>Encryption using SSL over HTTPS helps to protect messages in transit.</li>
<li>And we also may encrypt messages while storing them on backend hosts.</li>
</ul>
<h3 id="monitoring">Monitoring</h3>
<ul>
<li>Monitoring is critical for every system.</li>
<li>With regards to distributed message queue, we need to monitor components (or microservices) that we built: fronted, metadata and backend services.</li>
<li>As well as provide visibility into customer's experience.</li>
<li>In other words, we need to monitor health of our distributed queue system and give customers ability to track state of their queues.</li>
<li>Each service we built has to emit metrics and write log data.</li>
<li>As operators of these services we need to create dashboards for each microservice and setup alerts.</li>
<li>And customers of our queue have to be able to create dashboards and set up alerts as well.</li>
<li>For this purpose, integration with monitoring system is required.</li>
<li>Many times this topic is omitted by interviwers but it's very important.</li>
</ul>
<h2 id="final-look">Final Look</h2>
<p><img alt="" src="image/distributedMessageQueue/1634619758007.png" /></p>
<ul>
<li>Is our system scalable?<ul>
<li>Yes. As every component is scalable.</li>
<li>When load increases, we just add more load balancers, more FrontEnd hosts, more Metadata service cache shards, more backend clusters and hosts.</li>
</ul>
</li>
<li>Is our system highly available?<ul>
<li>Yes. As there is no a single point of failure, each component is deployed across several data centers. Individual hosts may die, network partitions may happen, but with this redundancy in place our system will continue to operate.</li>
</ul>
</li>
<li>Is our system highly performant?<ul>
<li>It's actually very well depends on the implementation, hardware and network setup.</li>
<li>Each individual microservice needs to be fast.</li>
<li>And we need to run our software in high-performance data centers.</li>
</ul>
</li>
<li>Is our system durable?<ul>
<li>Sure. We replicate data while storing and ensure messages are not lost during the transfer from a producer and to a consumer.</li>
</ul>
</li>
</ul>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="distributedCache.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Distributed Cache" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Distributed Cache
            </div>
          </div>
        </a>
      
      
        
        <a href="notificationService.html" class="md-footer__link md-footer__link--next" aria-label="Next: Notification Service" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Notification Service
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
  <div class="md-footer-social">
    
      
      
      <a href="mailto:theravindu@gmail.com" target="_blank" rel="noopener" title="" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M476 3.2 12.5 270.6c-18.1 10.4-15.8 35.6 2.2 43.2L121 358.4l287.3-253.2c5.5-4.9 13.3 2.6 8.6 8.3L176 407v80.5c0 23.6 28.5 32.9 42.5 15.8L282 426l124.6 52.2c14.2 6 30.4-2.9 33-18.2l72-432C515 7.8 493.3-6.8 476 3.2z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.tracking"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.477d984a.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.82b56eb2.min.js"></script>
      
        <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
      
    
  </body>
</html>